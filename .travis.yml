language: c

branches:
  only:
    - master
    - release

dist: trusty
sudo: required

matrix:
  include:
    - os: linux

rvm:
  - 2.2.3

install:
  - sudo apt-get install -y rpm ruby ruby-dev git
  - rvm install ruby-2.2.3
  - rvm use 2.2.3 --default
  - gem install fpm

script:
  - export PACKAGE_VERSION="`cat VERSION`"
  - export PACKAGE_ITERATION="${PACKAGE_ITERATION}${TRAVIS_BUILD_NUMBER}.`git rev-parse --short --verify HEAD^{commit}`";
  - mkdir build
  - mkdir build/bin
  - fpm -s empty -t rpm -p build/bin --name ponydep-ncurses-libs-5-compat --conflicts ponydep-ncurses-libs-5        --provides ponydep-ncurses --version "${PACKAGE_VERSION}" --iteration "${PACKAGE_ITERATION}" --description "An RPM to satisfy the ponyc dependency on ncurses" --depends "ncurses-compat-libs>=6"
  - fpm -s empty -t rpm -p build/bin --name ponydep-ncurses-libs-5        --conflicts ponydep-ncurses-libs-5-compat --provides ponydep-ncurses --version "${PACKAGE_VERSION}" --iteration "${PACKAGE_ITERATION}" --description "An RPM to satisfy the ponyc dependency on ncurses" --depends "ncurses<6" 

after_success:
  - sh .bintray.sh rpm "${PACKAGE_VERSION}-${PACKAGE_ITERATION}" ponydep-ncurses-libs-5
  - sh .bintray.sh rpm "${PACKAGE_VERSION}-${PACKAGE_ITERATION}" ponydep-ncurses-libs-5-compat

notifications:
  email:
    on_success: always
    on_failure: always
    recipients:
    - kevincantu@gmail.com

deploy:
  - provider: bintray
    user: killerswan
    file: /home/travis/build/killerswan/ponydep-ncurses/bintray_rpm_ponydep-ncurses-libs-5.yml
    on:
      branch: release
    key:
      secure: uYe22gfbHGnWHbJqYo2HKkvg2agLjt9JlocoDHDW4Vikh1ih+FfPDkqG1MsPEHHnAGQw2oAx04jjbAVurV1wLzcugRTgCHRDnFIfR7zldagmGNtu81w+3UzVySIzcx43+EgVdImJ2AkdhBAhxIlwB23No/lu03bwYT6VI39HaObTGvbV/ND+KaCdlPFXDIzMVbgwp2S27XG7g1X88MIh5gxqxeawCQ40TVkVjXcVTOqSG18ZduEmMCYSHZsxKI3TXlfPf2vvrzkYJXVg7oLptef8fOdEdgDTsyDq0EIBFqFm5HugJ5D+7xmjSDvT2hSI+dkifzrsZPn5w9bJi+TmPTVNpz9IYDwwyA5c6DIZiSB8bY8jWqXXQsmmEKf+OxVxwfnAzCz1tVvfhQAoS1BZEeUNYdQmM6CJj9nWyHEpskm38SvKlJqLBbadi1jzcv4HHHUaKuITFF8bK7mRdF6oH4Jzw6+PuEo7N9nN3iabHct9BAExK8QrZuw/PvkbOgFM8zx+Uhnv67lHAvGbgPhCMiCEtD72MA7ch8wWSzhd7ksGV2ym5GhAsdEkXDboFmEiDFYUuOsZIDcqIzv2oiyFJ412H9WggrTfrLvl1C1CQDzGExC0eQ6hn2dXLPN4BmStAvryI1shMbmokQUFNdnK8+K6jsEN3QlquSA2pX5W5XY=

  - provider: bintray
    user: killerswan
    file: /home/travis/build/killerswan/ponydep-ncurses/bintray_rpm_ponydep-ncurses-libs-5-compat.yml
    on:
      branch: release
    key:
      secure: uYe22gfbHGnWHbJqYo2HKkvg2agLjt9JlocoDHDW4Vikh1ih+FfPDkqG1MsPEHHnAGQw2oAx04jjbAVurV1wLzcugRTgCHRDnFIfR7zldagmGNtu81w+3UzVySIzcx43+EgVdImJ2AkdhBAhxIlwB23No/lu03bwYT6VI39HaObTGvbV/ND+KaCdlPFXDIzMVbgwp2S27XG7g1X88MIh5gxqxeawCQ40TVkVjXcVTOqSG18ZduEmMCYSHZsxKI3TXlfPf2vvrzkYJXVg7oLptef8fOdEdgDTsyDq0EIBFqFm5HugJ5D+7xmjSDvT2hSI+dkifzrsZPn5w9bJi+TmPTVNpz9IYDwwyA5c6DIZiSB8bY8jWqXXQsmmEKf+OxVxwfnAzCz1tVvfhQAoS1BZEeUNYdQmM6CJj9nWyHEpskm38SvKlJqLBbadi1jzcv4HHHUaKuITFF8bK7mRdF6oH4Jzw6+PuEo7N9nN3iabHct9BAExK8QrZuw/PvkbOgFM8zx+Uhnv67lHAvGbgPhCMiCEtD72MA7ch8wWSzhd7ksGV2ym5GhAsdEkXDboFmEiDFYUuOsZIDcqIzv2oiyFJ412H9WggrTfrLvl1C1CQDzGExC0eQ6hn2dXLPN4BmStAvryI1shMbmokQUFNdnK8+K6jsEN3QlquSA2pX5W5XY=
